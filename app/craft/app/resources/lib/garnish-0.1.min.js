/*
 2013 Pixel & Tonic, Inc.. All rights reserved.
 @author    Brandon Kelly <brandon@pixelandtonic.com>
 @version   0.1
 @license   THIS IS NO F.O.S.S!
*/
(function(c){function t(){"undefined"==typeof s&&(s=elementResizeDetectorMaker());return s}function u(a){c(a).trigger("resize")}var q=function(){};q.extend=function(a,b){var c=q.prototype.extend;q._prototyping=!0;var d=new this;c.call(d,a);d.base=function(){};delete q._prototyping;var f=d.constructor,g=d.constructor=function(){if(!q._prototyping)if(this._constructing||this.constructor==g)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||
c).call(arguments[0],d)};g.ancestor=this;g.extend=this.extend;g.forEach=this.forEach;g.implement=this.implement;g.prototype=d;g.toString=this.toString;g.valueOf=function(a){return"object"==a?g:f.valueOf()};c.call(g,b);"function"==typeof g.init&&g.init();return g};q.prototype={extend:function(a,b){if(1<arguments.length){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||q.prototype.base;this.base=c;var b=
d.apply(this,arguments);this.base=a;return b};b.valueOf=function(a){return"object"==a?b:d};b.toString=q.toString}this[a]=b}else if(a){var f=q.prototype.extend;q._prototyping||"function"==typeof this||(f=this.extend||f);for(var g={toSource:null},k=["constructor","toString","valueOf"],h=q._prototyping?0:1;l=k[h++];)a[l]!=g[l]&&f.call(this,l,a[l]);for(var l in a)g[l]||(k=Object.getOwnPropertyDescriptor(a,l),"undefined"!=typeof k.value?f.call(this,l,k.value):Object.defineProperty(this,l,k))}return this}};
q=q.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});if("undefined"!=typeof Garnish)throw"Garnish is already defined!";Garnish={$win:c(window),$doc:c(document),
$bod:c(document.body)};Garnish.rtl=Garnish.$bod.hasClass("rtl");Garnish.ltr=!Garnish.rtl;Garnish=c.extend(Garnish,{$scrollContainer:Garnish.$win,DELETE_KEY:8,SHIFT_KEY:16,CTRL_KEY:17,ALT_KEY:18,RETURN_KEY:13,ESC_KEY:27,SPACE_KEY:32,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,A_KEY:65,S_KEY:83,CMD_KEY:91,PRIMARY_CLICK:1,SECONDARY_CLICK:3,X_AXIS:"x",Y_AXIS:"y",FX_DURATION:100,TEXT_NODE:3,log:function(a){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(a)},_isMobileBrowser:null,
_isMobileOrTabletBrowser:null,isMobileBrowser:function(a){var b=a?"_isMobileOrTabletBrowser":"_isMobileBrowser";if(null===Garnish[b]){var c=navigator.userAgent||navigator.vendor||window.opera;Garnish[b]=RegExp("(android|bbd+|meego).+mobile|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|wap|windows ce|xda|xiino"+
(a?"|android|ipad|playbook|silk":""),"i").test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(c.substr(0,
4))}return Garnish[b]},isArray:function(a){return a instanceof Array},isJquery:function(a){return a instanceof jQuery},isString:function(a){return"string"==typeof a},hasAttr:function(a,b){var e=c(a).attr(b);return"undefined"!=typeof e&&!1!==e},isTextNode:function(a){return a.nodeType==Garnish.TEXT_NODE},getOffset:function(a){this.getOffset._offset=c(a).offset();Garnish.$scrollContainer[0]!=Garnish.$win[0]&&(this.getOffset._offset.top+=Garnish.$scrollContainer.scrollTop(),this.getOffset._offset.left+=
Garnish.$scrollContainer.scrollLeft());return this.getOffset._offset},getDist:function(a,b,c,d){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2))},hitTest:function(a,b,e){Garnish.hitTest._$elem=c(e);Garnish.hitTest._offset=Garnish.hitTest._$elem.offset();Garnish.hitTest._x1=Garnish.hitTest._offset.left;Garnish.hitTest._y1=Garnish.hitTest._offset.top;Garnish.hitTest._x2=Garnish.hitTest._x1+Garnish.hitTest._$elem.outerWidth();Garnish.hitTest._y2=Garnish.hitTest._y1+Garnish.hitTest._$elem.outerHeight();
return a>=Garnish.hitTest._x1&&a<Garnish.hitTest._x2&&b>=Garnish.hitTest._y1&&b<Garnish.hitTest._y2},isCursorOver:function(a,b){return Garnish.hitTest(a.pageX,a.pageY,b)},copyTextStyles:function(a,b){var e=c(a);c(b).css({fontFamily:e.css("fontFamily"),fontSize:e.css("fontSize"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),lineHeight:e.css("lineHeight"),textAlign:e.css("textAlign"),textIndent:e.css("textIndent"),whiteSpace:e.css("whiteSpace"),wordSpacing:e.css("wordSpacing"),
wordWrap:e.css("wordWrap")})},getBodyScrollTop:function(){Garnish.getBodyScrollTop._scrollTop=document.body.scrollTop;0>Garnish.getBodyScrollTop._scrollTop?Garnish.getBodyScrollTop._scrollTop=0:(Garnish.getBodyScrollTop._maxScrollTop=Garnish.$bod.outerHeight()-Garnish.$win.height(),Garnish.getBodyScrollTop._scrollTop>Garnish.getBodyScrollTop._maxScrollTop&&(Garnish.getBodyScrollTop._scrollTop=Garnish.getBodyScrollTop._maxScrollTop));return Garnish.getBodyScrollTop._scrollTop},requestAnimationFrame:function(){var a=
window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};return function(b){return a(b)}}(),cancelAnimationFrame:function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(b){return a(b)}}(),scrollContainerToElement:function(a,b){if("undefined"===typeof b)var e=c(a),d=e.scrollParent();else var d=c(a),e=c(b);if("HTML"===d.prop("nodeName")||
d[0]==Garnish.$doc[0])d=Garnish.$win;var f=d.scrollTop(),g=e.offset().top,g=d[0]==window?g-f:g-d.offset().top,k=!1;if(0>g)k=f+g-10;else{var e=e.outerHeight(),h=d[0]==window?window.innerHeight:d[0].clientHeight;g+e>h&&(k=f+(g-(h-e))+10)}!1!==k&&(d[0]==window?c("html").velocity("scroll",{offset:k+"px",mobileHA:!1}):d.scrollTop(k))},SHAKE_STEPS:10,SHAKE_STEP_DURATION:25,shake:function(a,b){var e=c(a);b||(b="margin-left");var d=parseInt(e.css(b));isNaN(d)&&(d=0);for(var f=0;f<=Garnish.SHAKE_STEPS;f++)(function(a){setTimeout(function(){Garnish.shake._properties=
{};Garnish.shake._properties[b]=d+(a%2?-1:1)*(10-a);e.velocity(Garnish.shake._properties,Garnish.SHAKE_STEP_DURATION)},Garnish.SHAKE_STEP_DURATION*a)})(f)},getElement:function(a){return c.makeArray(a)[0]},getInputBasename:function(a){return(a=c(a).attr("name"))?a.replace(/\[.*/,""):null},getInputPostVal:function(a){var b=a.attr("type"),c=a.val();return"checkbox"==b||"radio"==b?a.prop("checked")?c:null:Garnish.isArray(c)&&"[]"!=a.attr("name").substr(-2)?c.length?c[c.length-1]:null:c},findInputs:function(a){return c(a).find("input,text,textarea,select,button")},
getPostData:function(a){var b={},c={};a=Garnish.findInputs(a);for(var d=0;d<a.length;d++){var f=a.eq(d);if(!f.prop("disabled")){var g=f.attr("name");if(g&&(f=Garnish.getInputPostVal(f),null!==f)){var k="[]"==g.substr(-2);if(k){var h=g.substring(0,g.length-2);"undefined"==typeof c[h]&&(c[h]=0)}Garnish.isArray(f)||(f=[f]);for(var l=0;l<f.length;l++)k&&(g=h+"["+c[h]+"]",c[h]++),b[g]=f[l]}}}return b},copyInputValues:function(a,b){for(var c=Garnish.findInputs(a),d=Garnish.findInputs(b),f=0;f<c.length&&
"undefined"!=typeof d[f];f++)d.eq(f).val(c.eq(f).val())},isCtrlKeyPressed:function(a){return window.navigator.platform.match(/Mac/)?a.metaKey:a.ctrlKey&&!a.altKey}});Garnish.Base=q.extend({settings:null,_eventHandlers:null,_namespace:null,_$listeners:null,_disabled:!1,constructor:function(){this._eventHandlers=[];this._namespace=".Garnish"+Math.floor(1E9*Math.random());this._listeners=[];this.init.apply(this,arguments)},init:c.noop,setSettings:function(a,b){this.settings=c.extend({},"undefined"==
typeof this.settings?{}:this.settings,b,a)},on:function(a,b,c){"function"==typeof b&&(c=b,b={});a=this._normalizeEvents(a);for(var d=0;d<a.length;d++){var f=a[d];this._eventHandlers.push({type:f[0],namepsace:f[1],data:b,handler:c})}},off:function(a,b){a=this._normalizeEvents(a);for(var c=0;c<a.length;c++)for(var d=a[c],f=this._eventHandlers.length-1;0<=f;f--){var g=this._eventHandlers[f];g.type!=d[0]||d[1]&&g.namespace!=d[1]||g.handler!==b||this._eventHandlers.splice(f,1)}},trigger:function(a,b){var e=
{type:a,target:this};"undefined"==typeof params&&(params=[]);for(var d=0;d<this._eventHandlers.length;d++){var f=this._eventHandlers[d];if(f.type==a){var g=c.extend({data:f.data},b,e);f.handler(g)}}},_normalizeEvents:function(a){"string"==typeof a&&(a=a.split(" "));for(var b=0;b<a.length;b++)"string"==typeof a[b]&&(a[b]=a[b].split("."));return a},_splitEvents:function(a){if("string"==typeof a){a=a.split(",");for(var b=0;b<a.length;b++)a[b]=c.trim(a[b])}return a},_formatEvents:function(a){a=this._splitEvents(a).slice(0);
for(var b=0;b<a.length;b++)a[b]+=this._namespace;return a.join(" ")},addListener:function(a,b,e,d){var f=c(a);f.length&&(b=this._splitEvents(b),"undefined"==typeof d&&"object"!=typeof e&&(d=e,e={}),d="function"==typeof d?c.proxy(d,this):c.proxy(this,d),f.on(this._formatEvents(b),e,c.proxy(function(){this._disabled||d.apply(this,arguments)},this)),-1==c.inArray(a,this._listeners)&&this._listeners.push(a))},removeListener:function(a,b){c(a).off(this._formatEvents(b))},removeAllListeners:function(a){c(a).off(this._namespace)},
disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this.trigger("destroy");this.removeAllListeners(this._listeners)}});var s;c.extend(jQuery.event.special,{activate:{setup:function(a,b,e){var d=c(this);d.on({"mousedown.garnish-activate":function(a){a.preventDefault()},"click.garnish-activate":function(a){a.preventDefault();d.hasClass("disabled")||d.trigger("activate")},"keydown.garnish-activate":function(a){this==d[0]&&a.keyCode==Garnish.SPACE_KEY&&(a.preventDefault(),
d.hasClass("disabled")||(d.addClass("active"),Garnish.$doc.on("keyup.garnish-activate",function(a){d.removeClass("active");a.keyCode==Garnish.SPACE_KEY&&(a.preventDefault(),d.trigger("activate"));Garnish.$doc.off("keyup.garnish-activate")})))}});d.hasClass("disabled")?d.removeAttr("tabindex"):d.attr("tabindex","0")},teardown:function(){c(this).off(".garnish-activate")}},textchange:{setup:function(a,b,e){var d=c(this);d.data("garnish-textchange-value",d.val());d.on("keypress.garnish-textchange keyup.garnish-textchange change.garnish-textchange blur.garnish-textchange",
function(a){a=d.val();a!=d.data("garnish-textchange-value")&&(d.data("garnish-textchange-value",a),d.trigger("textchange"))})},teardown:function(){c(this).off(".garnish-textchange")},handle:function(a,b){var e=this,d=arguments,f=b&&"undefined"!=typeof b.delay?b.delay:a.data&&"undefined"!=typeof a.data.delay?a.data.delay:null,g=a.handleObj,k=c.data(a.target);if(f)k.delayTimeout&&clearTimeout(k.delayTimeout),k.delayTimeout=setTimeout(function(){g.handler.apply(e,d)},f);else return g.handler.apply(e,
d)}},resize:{setup:function(a,b,e){if(this==window)return!1;c("> :last-child",this).addClass("last");t().listenTo(this,u)},teardown:function(){if(this==window)return!1;t().removeListener(this,u)}}});jQuery.each(["activate","textchange","resize"],function(a,b){jQuery.fn[b]=function(a,c){return 0<arguments.length?this.on(b,null,a,c):this.trigger(b)}});Garnish.BaseDrag=Garnish.Base.extend({$items:null,dragging:!1,mousedownX:null,mousedownY:null,realMouseX:null,realMouseY:null,mouseX:null,mouseY:null,
mouseDistX:null,mouseDistY:null,mouseOffsetX:null,mouseOffsetY:null,$targetItem:null,scrollProperty:null,scrollAxis:null,scrollDist:null,scrollProxy:null,scrollFrame:null,_:null,init:function(a,b){"undefined"==typeof b&&c.isPlainObject(a)&&(b=a,a=null);this.settings=c.extend({},Garnish.BaseDrag.defaults,b);this.$items=c();this._={};a&&this.addItems(a)},allowDragging:function(){return!0},startDragging:function(){this.dragging=!0;this.onDragStart()},drag:function(a){a&&(this.drag._scrollProperty=null,
this.settings.axis!=Garnish.X_AXIS&&(this.drag._winScrollTop=Garnish.$win.scrollTop(),this.drag._minMouseScrollY=this.drag._winScrollTop+Garnish.BaseDrag.windowScrollTargetSize,this.mouseY<this.drag._minMouseScrollY?(this.drag._scrollProperty="scrollTop",this.drag._scrollAxis="Y",this.drag._scrollDist=Math.round((this.mouseY-this.drag._minMouseScrollY)/2)):(this.drag._maxMouseScrollY=this.drag._winScrollTop+Garnish.$win.height()-Garnish.BaseDrag.windowScrollTargetSize,this.mouseY>this.drag._maxMouseScrollY&&
(this.drag._scrollProperty="scrollTop",this.drag._scrollAxis="Y",this.drag._scrollDist=Math.round((this.mouseY-this.drag._maxMouseScrollY)/2)))),this.drag._scrollProperty||this.settings.axis==Garnish.Y_AXIS||(this.drag._winScrollLeft=Garnish.$win.scrollLeft(),this.drag._minMouseScrollX=this.drag._winScrollLeft+Garnish.BaseDrag.windowScrollTargetSize,this.mouseX<this.drag._minMouseScrollX?(this.drag._scrollProperty="scrollLeft",this.drag._scrollAxis="X",this.drag._scrollDist=Math.round((this.mouseX-
this.drag._minMouseScrollX)/2)):(this.drag._maxMouseScrollX=this.drag._winScrollLeft+Garnish.$win.width()-Garnish.BaseDrag.windowScrollTargetSize,this.mouseX>this.drag._maxMouseScrollX&&(this.drag._scrollProperty="scrollLeft",this.drag._scrollAxis="X",this.drag._scrollDist=Math.round((this.mouseX-this.drag._maxMouseScrollX)/2)))),this.drag._scrollProperty?(this.scrollProperty||(this.scrollProxy||(this.scrollProxy=c.proxy(this,"_scrollWindow")),this.scrollFrame&&(Garnish.cancelAnimationFrame(this.scrollFrame),
this.scrollFrame=null),this.scrollFrame=Garnish.requestAnimationFrame(this.scrollProxy)),this.scrollProperty=this.drag._scrollProperty,this.scrollAxis=this.drag._scrollAxis,this.scrollDist=this.drag._scrollDist):this._cancelWindowScroll());this.onDrag()},stopDragging:function(){this.dragging=!1;this.onDragStop();this._cancelWindowScroll()},addItems:function(a){a=c.makeArray(a);for(var b=0;b<a.length;b++){var e=a[b];c.data(e,"drag")&&(Garnish.log("Element was added to more than one dragger"),c.data(e,
"drag").removeItems(e));c.data(e,"drag",this);this.addListener(e,"mousedown","_handleMouseDown")}this.$items=this.$items.add(a)},removeItems:function(a){a=c.makeArray(a);for(var b=0;b<a.length;b++){var e=a[b],d=c.inArray(e,this.$items);-1!=d&&(this._deinitItem(e),this.$items.splice(d,1))}},removeAllItems:function(){for(var a=0;a<this.$items.length;a++)this._deinitItem(this.$items[a]);this.$items=c()},destroy:function(){this.removeAllItems();this.base()},onDragStart:function(){Garnish.requestAnimationFrame(c.proxy(function(){this.trigger("dragStart");
this.settings.onDragStart()},this))},onDrag:function(){Garnish.requestAnimationFrame(c.proxy(function(){this.trigger("drag");this.settings.onDrag()},this))},onDragStop:function(){Garnish.requestAnimationFrame(c.proxy(function(){this.trigger("dragStop");this.settings.onDragStop()},this))},_handleMouseDown:function(a){if(a.which==Garnish.PRIMARY_CLICK&&!this.$targetItem){var b=c(a.target),e=this._getItemHandle(a.currentTarget);!b.is(e)&&!b.closest(e).length||a.currentTarget!=a.target&&this.settings.ignoreHandleSelector&&
(b.is(this.settings.ignoreHandleSelector)||b.closest(this.settings.ignoreHandleSelector).length)||(a.preventDefault(),this.allowDragging()&&(this.$targetItem=c(a.currentTarget),this.mousedownX=this.mouseX=a.pageX,this.mousedownY=this.mouseY=a.pageY,b=this.$targetItem.offset(),this.mouseOffsetX=a.pageX-b.left,this.mouseOffsetY=a.pageY-b.top,this.addListener(Garnish.$doc,"mousemove","_handleMouseMove"),this.addListener(Garnish.$doc,"mouseup","_handleMouseUp")))}},_getItemHandle:function(a){if(this.settings.handle){if("object"==
typeof this.settings.handle)return c(this.settings.handle);if("string"==typeof this.settings.handle)return c(this.settings.handle,a);if("function"==typeof this.settings.handle)return c(this.settings.handle(a))}return c(a)},_handleMouseMove:function(a){a.preventDefault();this.realMouseX=a.pageX;this.realMouseY=a.pageY;this.settings.axis!=Garnish.Y_AXIS&&(this.mouseX=a.pageX);this.settings.axis!=Garnish.X_AXIS&&(this.mouseY=a.pageY);this.mouseDistX=this.mouseX-this.mousedownX;this.mouseDistY=this.mouseY-
this.mousedownY;this.dragging||(this._handleMouseMove._mouseDist=Garnish.getDist(this.mousedownX,this.mousedownY,this.realMouseX,this.realMouseY),this._handleMouseMove._mouseDist>=Garnish.BaseDrag.minMouseDist&&this.startDragging());this.dragging&&this.drag(!0)},_handleMouseUp:function(a){this.removeAllListeners(Garnish.$doc);this.dragging&&this.stopDragging();this.$targetItem=null},_scrollWindow:function(){this._.scrollPos=Garnish.$scrollContainer[this.scrollProperty]();Garnish.$scrollContainer[this.scrollProperty](this._.scrollPos+
this.scrollDist);this["mouse"+this.scrollAxis]-=this._.scrollPos-Garnish.$scrollContainer[this.scrollProperty]();this["realMouse"+this.scrollAxis]=this["mouse"+this.scrollAxis];this.drag();this.scrollFrame=Garnish.requestAnimationFrame(this.scrollProxy)},_cancelWindowScroll:function(){this.scrollFrame&&(Garnish.cancelAnimationFrame(this.scrollFrame),this.scrollFrame=null);this.scrollDist=this.scrollAxis=this.scrollProperty=null},_deinitItem:function(a){this.removeAllListeners(a);c.removeData(a,"drag")}},
{minMouseDist:1,windowScrollTargetSize:25,defaults:{handle:null,axis:null,ignoreHandleSelector:"input, textarea, button, select, .btn",onDragStart:c.noop,onDrag:c.noop,onDragStop:c.noop}});Garnish.CheckboxSelect=Garnish.Base.extend({$container:null,$all:null,$options:null,init:function(a){this.$container=c(a);this.$container.data("checkboxSelect")&&(Garnish.log("Double-instantiating a checkbox select on an element"),this.$container.data("checkbox-select").destroy());this.$container.data("checkboxSelect",
this);a=this.$container.find("input");this.$all=a.filter(".all:first");this.$options=a.not(this.$all);this.addListener(this.$all,"change","onAllChange")},onAllChange:function(){var a=this.$all.prop("checked");this.$options.prop({checked:a,disabled:a})},destroy:function(){this.$container.removeData("checkboxSelect");this.base()}});Garnish.ContextMenu=Garnish.Base.extend({$target:null,options:null,$menu:null,showingMenu:!1,init:function(a,b,e){this.$target=c(a);this.$target.data("contextmenu")&&(Garnish.log("Double-instantiating a context menu on an element"),
this.$target.data("contextmenu").destroy());this.$target.data("contextmenu",this);this.options=b;this.setSettings(e,Garnish.ContextMenu.defaults);Garnish.ContextMenu.counter++;this.enable()},buildMenu:function(){this.$menu=c('<div class="'+this.settings.menuClass+'" style="display: none" />');var a=c("<ul/>").appendTo(this.$menu),b;for(b in this.options){var e=this.options[b];if("-"==e)c("<hr/>").appendTo(this.$menu),a=c("<ul/>").appendTo(this.$menu);else{var d=c("<li></li>").appendTo(a),d=c("<a>"+
e.label+"</a>").appendTo(d);"function"==typeof e.onClick&&function(a,b){setTimeout(c.proxy(function(){a.mousedown(c.proxy(function(a){this.hideMenu();b.call(this.currentTarget,c.extend(a,{currentTarget:this.currentTarget}))},this))},this),1)}.call(this,d,e.onClick)}}},showMenu:function(a){if("mousedown"!=a.type||a.which==Garnish.SECONDARY_CLICK)"contextmenu"==a.type&&a.preventDefault(),this.showing&&a.currentTarget==this.currentTarget||(this.currentTarget=a.currentTarget,this.$menu||this.buildMenu(),
this.$menu.appendTo(document.body),this.$menu.show(),this.$menu.css({left:a.pageX+1,top:a.pageY-4}),this.showing=!0,setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","hideMenu")},this),0))},hideMenu:function(){this.removeListener(Garnish.$doc,"mousedown");this.$menu.hide();this.showing=!1},enable:function(){this.addListener(this.$target,"contextmenu,mousedown","showMenu")},disable:function(){this.removeListener(this.$target,"contextmenu,mousedown")},destroy:function(){this.$target.removeData("contextmenu");
this.base()}},{defaults:{menuClass:"menu"},counter:0});Garnish.Drag=Garnish.BaseDrag.extend({targetItemWidth:null,targetItemHeight:null,targetItemPositionInDraggee:null,$draggee:null,otherItems:null,totalOtherItems:null,helpers:null,helperTargets:null,helperPositions:null,helperLagIncrement:null,updateHelperPosProxy:null,updateHelperPosFrame:null,lastMouseX:null,lastMouseY:null,_returningHelpersToDraggees:!1,init:function(a,b){"undefined"==typeof b&&c.isPlainObject(a)&&(b=a,a=null);b=c.extend({},
Garnish.Drag.defaults,b);this.base(a,b)},allowDragging:function(){return!this._returningHelpersToDraggees},startDragging:function(){this.helpers=[];this.helperTargets=[];this.helperPositions=[];this.lastMouseX=this.lastMouseY=null;this.targetItemWidth=this.$targetItem.outerWidth();this.targetItemHeight=this.$targetItem.outerHeight();this.draggeeDisplay=this.$targetItem.css("display");this.setDraggee(this.findDraggee());this.otherItems=[];for(var a=0;a<this.$items.length;a++){var b=this.$items[a];
-1==c.inArray(b,this.$draggee)&&this.otherItems.push(b)}this.totalOtherItems=this.otherItems.length;this.updateHelperPosProxy||(this.updateHelperPosProxy=c.proxy(this,"_updateHelperPos"));this.helperLagIncrement=1==this.helpers.length?0:this.settings.helperLagIncrementDividend/(this.helpers.length-1);this.updateHelperPosFrame=Garnish.requestAnimationFrame(this.updateHelperPosProxy);this.base()},setDraggee:function(a){this.targetItemPositionInDraggee=c.inArray(this.$targetItem[0],a.add(this.$targetItem[0]));
this.$draggee=c([this.$targetItem[0]].concat(a.not(this.$targetItem).toArray()));if(this.settings.singleHelper)this._createHelper(0);else for(a=0;a<this.$draggee.length;a++)this._createHelper(a);this.settings.removeDraggee?this.$draggee.hide():this.settings.collapseDraggees?(this.$targetItem.css("visibility","hidden"),this.$draggee.not(this.$targetItem).hide()):this.$draggee.css("visibility","hidden")},appendDraggee:function(a){if(a.length){if(!this.settings.collapseDraggees)var b=this.$draggee.length;
this.$draggee=c(this.$draggee.toArray().concat(a.toArray()));if(!this.settings.collapseDraggees)for(var e=this.$draggee.length;b<e;b++)this._createHelper(b);this.settings.removeDraggee||this.settings.collapseDraggees?a.hide():a.css("visibility","hidden")}},drag:function(a){this.draggeeVirtualMidpointX=this.mouseX-this.mouseOffsetX+this.targetItemWidth/2;this.draggeeVirtualMidpointY=this.mouseY-this.mouseOffsetY+this.targetItemHeight/2;this.base(a)},stopDragging:function(){Garnish.cancelAnimationFrame(this.updateHelperPosFrame);
this.base()},findDraggee:function(){switch(typeof this.settings.filter){case "function":return this.settings.filter();case "string":return this.$items.filter(this.settings.filter);default:return this.$targetItem}},getHelperTargetX:function(){return this.mouseX-this.mouseOffsetX},getHelperTargetY:function(){return this.mouseY-this.mouseOffsetY},returnHelpersToDraggees:function(){this._returningHelpersToDraggees=!0;for(var a=0;a<this.helpers.length;a++){var b=this.$draggee.eq(a),e=this.helpers[a];b.css({display:this.draggeeDisplay,
visibility:"hidden"});var b=b.offset(),d=0==a?c.proxy(this,"_showDraggee"):null;e.velocity({left:b.left,top:b.top},Garnish.FX_DURATION,d)}},onReturnHelpersToDraggees:function(){Garnish.requestAnimationFrame(c.proxy(function(){this.trigger("returnHelpersToDraggees");this.settings.onReturnHelpersToDraggees()},this))},_createHelper:function(a){var b=this.$draggee.eq(a),e=b.clone().addClass("draghelper");this.settings.copyDraggeeInputValuesToHelper&&Garnish.copyInputValues(b,e);e.find("[name]").attr("name",
"");e.css({width:b.width()+1,height:b.height(),margin:0});this.settings.helper&&(e="function"==typeof this.settings.helper?this.settings.helper(e):c(this.settings.helper).append(e));e.appendTo(Garnish.$bod);b=this._getHelperTarget(a);e.css({position:"absolute",top:b.top,left:b.left,zIndex:this.settings.helperBaseZindex+this.$draggee.length-a,opacity:this.settings.helperOpacity});this.helperPositions[a]={top:b.top,left:b.left};this.helpers.push(e)},_updateHelperPos:function(){if(this.mouseX!==this.lastMouseX||
this.mouseY!==this.lastMouseY){for(this._updateHelperPos._i=0;this._updateHelperPos._i<this.helpers.length;this._updateHelperPos._i++)this.helperTargets[this._updateHelperPos._i]=this._getHelperTarget(this._updateHelperPos._i);this.lastMouseX=this.mouseX;this.lastMouseY=this.mouseY}for(this._updateHelperPos._j=0;this._updateHelperPos._j<this.helpers.length;this._updateHelperPos._j++)this._updateHelperPos._lag=this.settings.helperLagBase+this.helperLagIncrement*this._updateHelperPos._j,this.helperPositions[this._updateHelperPos._j]=
{left:this.helperPositions[this._updateHelperPos._j].left+(this.helperTargets[this._updateHelperPos._j].left-this.helperPositions[this._updateHelperPos._j].left)/this._updateHelperPos._lag,top:this.helperPositions[this._updateHelperPos._j].top+(this.helperTargets[this._updateHelperPos._j].top-this.helperPositions[this._updateHelperPos._j].top)/this._updateHelperPos._lag},this.helpers[this._updateHelperPos._j].css(this.helperPositions[this._updateHelperPos._j]);this.updateHelperPosFrame=Garnish.requestAnimationFrame(this.updateHelperPosProxy)},
_getHelperTarget:function(a){return{left:this.getHelperTargetX()+this.settings.helperSpacingX*a,top:this.getHelperTargetY()+this.settings.helperSpacingY*a}},_showDraggee:function(){for(var a=0;a<this.helpers.length;a++)this.helpers[a].remove();this.helpers=null;this.$draggee.show().css("visibility","inherit");this.onReturnHelpersToDraggees();this._returningHelpersToDraggees=!1}},{defaults:{filter:null,singleHelper:!1,collapseDraggees:!1,removeDraggee:!1,copyDraggeeInputValuesToHelper:!1,helperOpacity:1,
helper:null,helperBaseZindex:1E3,helperLagBase:1,helperLagIncrementDividend:1.5,helperSpacingX:5,helperSpacingY:5,onReturnHelpersToDraggees:c.noop}});Garnish.DragDrop=Garnish.Drag.extend({$dropTargets:null,$activeDropTarget:null,init:function(a){a=c.extend({},Garnish.DragDrop.defaults,a);this.base(a)},updateDropTargets:function(){this.settings.dropTargets&&(this.$dropTargets="function"==typeof this.settings.dropTargets?c(this.settings.dropTargets()):c(this.settings.dropTargets),this.$dropTargets.length||
(this.$dropTargets=null))},onDragStart:function(){this.updateDropTargets();this.$activeDropTarget=null;this.base()},onDrag:function(){if(this.$dropTargets){this.onDrag._activeDropTarget=null;for(this.onDrag._i=0;this.onDrag._i<this.$dropTargets.length;this.onDrag._i++)if(this.onDrag._elem=this.$dropTargets[this.onDrag._i],Garnish.hitTest(this.mouseX,this.mouseY,this.onDrag._elem)){this.onDrag._activeDropTarget=this.onDrag._elem;break}if(this.$activeDropTarget&&this.onDrag._activeDropTarget!=this.$activeDropTarget[0]||
!this.$activeDropTarget&&null!==this.onDrag._activeDropTarget)this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass),this.$activeDropTarget=this.onDrag._activeDropTarget?c(this.onDrag._activeDropTarget).addClass(this.settings.activeDropTargetClass):null,this.settings.onDropTargetChange(this.$activeDropTarget)}this.base()},onDragStop:function(){this.$dropTargets&&this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass);
this.base()},fadeOutHelpers:function(){for(var a=0;a<this.helpers.length;a++)(function(a){a.velocity("fadeOut",{duration:Garnish.FX_DURATION,complete:function(){a.remove()}})})(this.helpers[a])}},{defaults:{dropTargets:null,onDropTargetChange:c.noop,activeDropTargetClass:"active"}});Garnish.DragMove=Garnish.BaseDrag.extend({onDrag:function(a,b){this.$targetItem.css({left:this.mouseX-this.mouseOffsetX,top:this.mouseY-this.mouseOffsetY})}});Garnish.DragSort=Garnish.Drag.extend({$heightedContainer:null,
$insertion:null,insertionVisible:!1,oldDraggeeIndexes:null,newDraggeeIndexes:null,closestItem:null,_midpointVersion:0,_$prevItem:null,init:function(a,b){"undefined"==typeof b&&c.isPlainObject(a)&&(b=a,a=null);b=c.extend({},Garnish.DragSort.defaults,b);this.base(a,b)},createInsertion:function(){if(this.settings.insertion)return"function"==typeof this.settings.insertion?c(this.settings.insertion(this.$draggee)):c(this.settings.insertion)},getHelperTargetX:function(){return 1!=this.settings.magnetStrength?
(this.getHelperTargetX._draggeeOffsetX=this.$draggee.offset().left,this.getHelperTargetX._draggeeOffsetX+(this.mouseX-this.mouseOffsetX-this.getHelperTargetX._draggeeOffsetX)/this.settings.magnetStrength):this.base()},getHelperTargetY:function(){return 1!=this.settings.magnetStrength?(this.getHelperTargetY._draggeeOffsetY=this.$draggee.offset().top,this.getHelperTargetY._draggeeOffsetY+(this.mouseY-this.mouseOffsetY-this.getHelperTargetY._draggeeOffsetY)/this.settings.magnetStrength):this.base()},
canInsertBefore:function(a){return!0},canInsertAfter:function(a){return!0},onDragStart:function(){this.oldDraggeeIndexes=this._getDraggeeIndexes();this.settings.moveTargetItemToFront&&1<this.$draggee.length&&this._getItemIndex(this.$draggee[0])>this._getItemIndex(this.$draggee[1])&&this.$draggee.first().insertBefore(this.$draggee[1]);this.$insertion=this.createInsertion();this._placeInsertionWithDraggee();this.closestItem=null;this._clearMidpoints();if(this.settings.container)for(this.$heightedContainer=
c(this.settings.container);!this.$heightedContainer.height();)this.$heightedContainer=this.$heightedContainer.parent();this.base()},onDrag:function(){this.$heightedContainer&&!Garnish.hitTest(this.mouseX,this.mouseY,this.$heightedContainer)?this.closestItem&&(this.closestItem=null,this._removeInsertion()):this.closestItem!==(this.closestItem=this._getClosestItem())&&null!==this.closestItem&&this._updateInsertion();this.base()},onDragStop:function(){this._removeInsertion();this.settings.moveTargetItemToFront||
0==this.targetItemPositionInDraggee||this.$targetItem.insertAfter(this.$draggee.eq(this.targetItemPositionInDraggee));this.returnHelpersToDraggees();this.base();this.$items=c().add(this.$items);this.newDraggeeIndexes=this._getDraggeeIndexes();if(this.newDraggeeIndexes.join(",")!=this.oldDraggeeIndexes.join(","))this.onSortChange()},onInsertionPointChange:function(){Garnish.requestAnimationFrame(c.proxy(function(){this.trigger("insertionPointChange");this.settings.onInsertionPointChange()},this))},
onSortChange:function(){Garnish.requestAnimationFrame(c.proxy(function(){this.trigger("sortChange");this.settings.onSortChange()},this))},_getItemIndex:function(a){return c.inArray(a,this.$items)},_getDraggeeIndexes:function(){for(var a=[],b=0;b<this.$draggee.length;b++)a.push(this._getItemIndex(this.$draggee[b]));return a},_getClosestItem:function(){this._getClosestItem._closestItem=null;this.settings.removeDraggee?this.insertionVisible&&this._testForClosestItem(this.$insertion[0]):this._testForClosestItem(this.$draggee[0]);
this._getClosestItem._closestItem&&(this._getClosestItem._midpoint=this._getItemMidpoint(this._getClosestItem._closestItem));this.settings.axis!=Garnish.Y_AXIS&&(this._getClosestItem._startXDist=this._getClosestItem._lastXDist=this._getClosestItem._closestItem?Math.abs(this._getClosestItem._midpoint.x-this.draggeeVirtualMidpointX):null);this.settings.axis!=Garnish.X_AXIS&&(this._getClosestItem._startYDist=this._getClosestItem._lastYDist=this._getClosestItem._closestItem?Math.abs(this._getClosestItem._midpoint.y-
this.draggeeVirtualMidpointY):null);for(this._getClosestItem._$otherItem=this.$draggee.first().prev();this._getClosestItem._$otherItem.length;){this._getClosestItem._midpoint=this._getItemMidpoint(this._getClosestItem._$otherItem[0]);this.settings.axis!=Garnish.Y_AXIS&&(this._getClosestItem._xDist=Math.abs(this._getClosestItem._midpoint.x-this.draggeeVirtualMidpointX));this.settings.axis!=Garnish.X_AXIS&&(this._getClosestItem._yDist=Math.abs(this._getClosestItem._midpoint.y-this.draggeeVirtualMidpointY));
if((this.settings.axis==Garnish.Y_AXIS||null!==this._getClosestItem._lastXDist&&this._getClosestItem._xDist>this._getClosestItem._lastXDist)&&(this.settings.axis==Garnish.X_AXIS||null!==this._getClosestItem._lastYDist&&this._getClosestItem._yDist>this._getClosestItem._lastYDist))break;this.settings.axis!=Garnish.Y_AXIS&&(this._getClosestItem._lastXDist=this._getClosestItem._xDist);this.settings.axis!=Garnish.X_AXIS&&(this._getClosestItem._lastYDist=this._getClosestItem._yDist);this.canInsertBefore(this._getClosestItem._$otherItem)&&
this._testForClosestItem(this._getClosestItem._$otherItem[0]);this._getClosestItem._$otherItem=this._getClosestItem._$otherItem.prev()}this.settings.axis!=Garnish.Y_AXIS&&(this._getClosestItem._lastXDist=this._getClosestItem._startXDist);this.settings.axis!=Garnish.X_AXIS&&(this._getClosestItem._lastYDist=this._getClosestItem._startYDist);for(this._getClosestItem._$otherItem=this.$draggee.last().next();this._getClosestItem._$otherItem.length;){this._getClosestItem._midpoint=this._getItemMidpoint(this._getClosestItem._$otherItem[0]);
this.settings.axis!=Garnish.Y_AXIS&&(this._getClosestItem._xDist=Math.abs(this._getClosestItem._midpoint.x-this.draggeeVirtualMidpointX));this.settings.axis!=Garnish.X_AXIS&&(this._getClosestItem._yDist=Math.abs(this._getClosestItem._midpoint.y-this.draggeeVirtualMidpointY));if((this.settings.axis==Garnish.Y_AXIS||null!==this._getClosestItem._lastXDist&&this._getClosestItem._xDist>this._getClosestItem._lastXDist)&&(this.settings.axis==Garnish.X_AXIS||null!==this._getClosestItem._lastYDist&&this._getClosestItem._yDist>
this._getClosestItem._lastYDist))break;this.settings.axis!=Garnish.Y_AXIS&&(this._getClosestItem._lastXDist=this._getClosestItem._xDist);this.settings.axis!=Garnish.X_AXIS&&(this._getClosestItem._lastYDist=this._getClosestItem._yDist);this.canInsertAfter(this._getClosestItem._$otherItem)&&this._testForClosestItem(this._getClosestItem._$otherItem[0]);this._getClosestItem._$otherItem=this._getClosestItem._$otherItem.next()}return this._getClosestItem._closestItem==this.$draggee[0]||this.insertionVisible&&
this._getClosestItem._closestItem==this.$insertion[0]?null:this._getClosestItem._closestItem},_clearMidpoints:function(){this._midpointVersion++;this._$prevItem=null},_getItemMidpoint:function(a){c.data(a,"midpointVersion")!=this._midpointVersion&&(this._getItemMidpoint._repositionDraggee=!this.settings.axis&&(!this.settings.removeDraggee||this.insertionVisible)&&a!=this.$draggee[0]&&(!this.$insertion||a!=this.$insertion.get(0)),this._getItemMidpoint._repositionDraggee?(this._$prevItem||(this._$prevItem=
(this.insertionVisible?this.$insertion:this.$draggee).first().prev()),this._moveDraggeeToItem(a),this._getItemMidpoint._$item=this.settings.removeDraggee?this.$insertion:this.$draggee):this._getItemMidpoint._$item=c(a),this._getItemMidpoint._offset=this._getItemMidpoint._$item.offset(),c.data(a,"midpoint",{x:this._getItemMidpoint._offset.left+this._getItemMidpoint._$item.outerWidth()/2,y:this._getItemMidpoint._offset.top+this._getItemMidpoint._$item.outerHeight()/2}),c.data(a,"midpointVersion",this._midpointVersion),
delete this._getItemMidpoint._$item,delete this._getItemMidpoint._offset,this._getItemMidpoint._repositionDraggee&&(this._$prevItem.length?this.$draggee.insertAfter(this._$prevItem):this.$draggee.prependTo(this.$draggee.parent()),this._placeInsertionWithDraggee()));return c.data(a,"midpoint")},_testForClosestItem:function(a){this._testForClosestItem._midpoint=this._getItemMidpoint(a);this._testForClosestItem._mouseDistX=Math.abs(this._testForClosestItem._midpoint.x-this.draggeeVirtualMidpointX);this._testForClosestItem._mouseDistY=
Math.abs(this._testForClosestItem._midpoint.y-this.draggeeVirtualMidpointY);if(null===this._getClosestItem._closestItem||this._testForClosestItem._mouseDistY<this._getClosestItem._closestItemMouseDistY||this._testForClosestItem._mouseDistY==this._getClosestItem._closestItemMouseDistY&&this._testForClosestItem._mouseDistX<=this._getClosestItem._closestItemMouseDistX)this._getClosestItem._closestItem=a,this._getClosestItem._closestItemMouseDistX=this._testForClosestItem._mouseDistX,this._getClosestItem._closestItemMouseDistY=
this._testForClosestItem._mouseDistY},_updateInsertion:function(){this.closestItem&&this._moveDraggeeToItem(this.closestItem);this._clearMidpoints();this.onInsertionPointChange()},_moveDraggeeToItem:function(a){this.$draggee.index()<c(a).index()?this.$draggee.insertAfter(a):this.$draggee.insertBefore(a);this._placeInsertionWithDraggee()},_placeInsertionWithDraggee:function(){this.$insertion&&(this.$insertion.insertBefore(this.$draggee.first()),this.insertionVisible=!0)},_removeInsertion:function(){this.insertionVisible&&
(this.$insertion.remove(),this.insertionVisible=!1)}},{defaults:{container:null,insertion:null,moveTargetItemToFront:!1,magnetStrength:1,onInsertionPointChange:c.noop,onSortChange:c.noop}});Garnish.EscManager=Garnish.Base.extend({handlers:null,init:function(){this.handlers=[];this.addListener(Garnish.$bod,"keyup",function(a){a.keyCode==Garnish.ESC_KEY&&this.escapeLatest(a)})},register:function(a,b){this.handlers.push({obj:a,func:b})},unregister:function(a){for(var b=this.handlers.length-1;0<=b;b--)this.handlers[b].obj==
a&&this.handlers.splice(b,1)},escapeLatest:function(a){if(this.handlers.length){var b=this.handlers.pop();("function"==typeof b.func?b.func:b.obj[b.func]).call(b.obj,a);"function"==typeof b.obj.trigger&&b.obj.trigger("escape")}}});Garnish.escManager=new Garnish.EscManager;Garnish.HUD=Garnish.Base.extend({$trigger:null,$fixedTriggerParent:null,$hud:null,$tip:null,$body:null,$header:null,$footer:null,$mainContainer:null,$main:null,$shade:null,showing:!1,orientation:null,init:function(a,b,e){this.$trigger=
c(a);this.setSettings(e,Garnish.HUD.defaults);this.on("show",this.settings.onShow);this.on("hide",this.settings.onHide);this.on("submit",this.settings.onSubmit);"undefined"==typeof Garnish.HUD.activeHUDs&&(Garnish.HUD.activeHUDs={});this.$shade=c("<div/>",{"class":this.settings.shadeClass});this.$hud=c("<div/>",{"class":this.settings.hudClass});this.$tip=c("<div/>",{"class":this.settings.tipClass}).appendTo(this.$hud);this.$body=c("<form/>",{"class":this.settings.bodyClass}).appendTo(this.$hud);this.$mainContainer=
c("<div/>",{"class":this.settings.mainContainerClass}).appendTo(this.$body);this.$main=c("<div/>",{"class":this.settings.mainClass}).appendTo(this.$mainContainer);this.updateBody(b);a=this.$trigger;do{if("fixed"==a.css("position")){this.$fixedTriggerParent=a;break}a=a.offsetParent()}while(a.length&&"HTML"!=a.prop("nodeName"));this.$fixedTriggerParent?this.$hud.css("position","fixed"):this.$hud.css("position","absolute");this.show();this.addListener(this.$body,"submit","_handleSubmit");this.addListener(this.$shade,
"click","hide");this.$fixedTriggerParent||Garnish.$scrollContainer[0]==Garnish.$win[0]||this.addListener(Garnish.$scrollContainer,"scroll","updateSizeAndPosition");this.settings.closeBtn&&this.addListener(this.settings.closeBtn,"activate","hide")},updateBody:function(a){this.removeListener(this.$main,"resize");this.$main.html("");this.$header&&(this.$hud.removeClass("has-header"),this.$header.remove(),this.$header=null);this.$footer&&(this.$hud.removeClass("has-footer"),this.$footer.remove(),this.$footer=
null);this.$main.append(a);a=this.$main.find("."+this.settings.headerClass+":first");var b=this.$main.find("."+this.settings.footerClass+":first");a.length&&(this.$header=a.insertBefore(this.$mainContainer),this.$hud.addClass("has-header"));b.length&&(this.$footer=b.insertAfter(this.$mainContainer),this.$hud.addClass("has-footer"))},show:function(a){a&&a.stopPropagation&&a.stopPropagation();if(!this.showing){if(this.settings.closeOtherHUDs)for(var b in Garnish.HUD.activeHUDs)Garnish.HUD.activeHUDs[b].hide();
this.$hud.css("top",Garnish.$scrollContainer.scrollTop());this.$shade.appendTo(Garnish.$bod);this.$hud.appendTo(Garnish.$bod);this.$hud.show();this.updateSizeAndPosition();this.$shade.show();this.showing=!0;Garnish.HUD.activeHUDs[this._namespace]=this;Garnish.escManager.register(this,"hide");this.onShow();Garnish.requestAnimationFrame(c.proxy(this,"updateSizeAndPosition"));this.enable()}},onShow:function(){this.trigger("show")},updateSizeAndPosition:function(){this.removeListener(this.$main,"resize");
var a,b,e,d,f,g,k,h,l,p,m,n;a=Garnish.$win.width();b=Garnish.$win.height();g=Garnish.$win.scrollLeft();k=Garnish.$win.scrollTop();e=this.$trigger.outerWidth();d=this.$trigger.outerHeight();f=this.$trigger.offset();this.$fixedTriggerParent?(f.left-=g,f.top-=k,h=f,p=l=k=g=0):(h=Garnish.getOffset(this.$trigger),l=Garnish.$scrollContainer.scrollLeft(),p=Garnish.$scrollContainer.scrollTop());f.right=f.left+e;f.bottom=f.top+d;h.right=h.left+e;h.bottom=h.top+d;this.$hud.css({width:""});this.$mainContainer.css({height:"",
"overflow-x":"","overflow-y":""});m=this.$body.width();n=this.$body.height();h={bottom:b+p-h.bottom,top:h.top-p,right:a+l-h.right,left:h.left-l};this.orientation=null;for(l=0;l<this.settings.orientations.length;l++){p=this.settings.orientations[l];if(h[p]-(this.settings.windowSpacing+this.settings.triggerSpacing)>=("top"==p||"bottom"==p?n:m)){this.orientation=p;break}if(!this.orientation||h[p]>h[this.orientation])this.orientation=p}this.orientation&&-1!=c.inArray(this.orientation,["bottom","top",
"right","left"])||(this.orientation="bottom");this.tipClass&&this.$tip.removeClass(this.tipClass);this.tipClass=this.settings.tipClass+"-"+Garnish.HUD.tipClasses[this.orientation];this.$tip.addClass(this.tipClass);"top"==this.orientation||"bottom"==this.orientation?(l=a-2*this.settings.windowSpacing,h=h[this.orientation]):(l=h[this.orientation],h=b-2*this.settings.windowSpacing);l<this.settings.minBodyWidth&&(l=this.settings.minBodyWidth);h<this.settings.minBodyHeight&&(h=this.settings.minBodyHeight);
if(m>l||m<this.settings.minBodyWidth)m=m>l?l:this.settings.minBodyWidth,this.$hud.width(m),this.$main.outerWidth()>l&&this.$mainContainer.css("overflow-x","scroll"),n=this.$body.height();if(n>h||n<this.settings.minBodyHeight)h=n=n>h?h:this.settings.minBodyHeight,this.$header&&(h-=this.$header.outerHeight()),this.$footer&&(h-=this.$footer.outerHeight()),this.$mainContainer.height(h),this.$main.outerHeight()>h&&this.$mainContainer.css("overflow-y","scroll");"top"==this.orientation||"bottom"==this.orientation?
(d=a+g-(m+this.settings.windowSpacing),g+=this.settings.windowSpacing,e=f.left+Math.round(e/2),m=e-Math.round(m/2),m>d&&(m=d),m<g&&(m=g),this.$hud.css("left",m),this.$tip.css({left:e-m-this.settings.tipWidth/2,top:""}),n="top"==this.orientation?f.top-(n+this.settings.triggerSpacing):f.bottom+this.settings.triggerSpacing,this.$hud.css("top",n)):(g=b+k-(n+this.settings.windowSpacing),k+=this.settings.windowSpacing,e=f.top+Math.round(d/2),n=e-Math.round(n/2),n>g&&(n=g),n<k&&(n=k),this.$hud.css("top",
n),this.$tip.css({top:e-n-this.settings.tipWidth/2,left:""}),m="left"==this.orientation?f.left-(m+this.settings.triggerSpacing):f.right+this.settings.triggerSpacing,this.$hud.css("left",m));Garnish.requestAnimationFrame(c.proxy(function(){this.addListener(this.$main,"resize","updateSizeAndPosition")},this))},hide:function(){this.disable();this.$hud.hide();this.$shade.hide();this.showing=!1;delete Garnish.HUD.activeHUDs[this._namespace];Garnish.escManager.unregister(this);this.onHide()},onHide:function(){this.trigger("hide")},
toggle:function(){this.showing?this.hide():this.show()},submit:function(){this.onSubmit()},onSubmit:function(){this.trigger("submit")},_handleSubmit:function(a){a.preventDefault();this.submit()}},{tipClasses:{bottom:"top",top:"bottom",right:"left",left:"right"},defaults:{shadeClass:"hud-shade",hudClass:"hud",tipClass:"tip",bodyClass:"body",headerClass:"header",footerClass:"footer",mainContainerClass:"main-container",mainClass:"main",orientations:["bottom","top","right","left"],triggerSpacing:10,windowSpacing:10,
tipWidth:30,minBodyWidth:200,minBodyHeight:0,onShow:c.noop,onHide:c.noop,onSubmit:c.noop,closeBtn:null,closeOtherHUDs:!0}});Garnish.LightSwitch=Garnish.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,$toggleTarget:null,on:null,dragger:null,dragStartMargin:null,init:function(a,b){this.$outerContainer=c(a);this.$outerContainer.data("lightswitch")&&(Garnish.log("Double-instantiating a switch on an element"),this.$outerContainer.data("lightswitch").destroy());this.$outerContainer.data("lightswitch",
this);this.setSettings(b,Garnish.LightSwitch.defaults);this.$innerContainer=this.$outerContainer.find(".container:first");this.$input=this.$outerContainer.find("input:first");this.$toggleTarget=c(this.$outerContainer.attr("data-toggle"));this.on=this.$outerContainer.hasClass("on");this.addListener(this.$outerContainer,"mousedown","_handleMouseDown");this.addListener(this.$outerContainer,"keydown","_handleKeyDown");this.dragger=new Garnish.BaseDrag(this.$outerContainer,{axis:Garnish.X_AXIS,ignoreHandleSelector:null,
onDragStart:c.proxy(this,"_handleDragStart"),onDrag:c.proxy(this,"_handleDrag"),onDragStop:c.proxy(this,"_handleDragStop")})},turnOn:function(){this.$innerContainer.velocity("stop").velocity({marginLeft:0},Garnish.FX_DURATION);this.$input.val(Garnish.Y_AXIS);this.on=!0;this.onChange();this.$toggleTarget.show();this.$toggleTarget.height("auto");var a=this.$toggleTarget.height();this.$toggleTarget.height(0);this.$toggleTarget.velocity("stop").velocity({height:a},Garnish.FX_DURATION,c.proxy(function(){this.$toggleTarget.height("auto")},
this))},turnOff:function(){this.$innerContainer.velocity("stop").velocity({marginLeft:Garnish.LightSwitch.offMargin},Garnish.FX_DURATION);this.$input.val("");this.on=!1;this.onChange();this.$toggleTarget.velocity("stop").velocity({height:0},Garnish.FX_DURATION)},toggle:function(a){this.on?this.turnOff():this.turnOn()},onChange:function(){this.trigger("change");this.settings.onChange();this.$outerContainer.trigger("change")},_handleMouseDown:function(){this.addListener(Garnish.$doc,"mouseup","_handleMouseUp")},
_handleMouseUp:function(){this.removeListener(Garnish.$doc,"mouseup");this.dragger.dragging||this.toggle()},_handleKeyDown:function(a){switch(a.keyCode){case Garnish.SPACE_KEY:this.toggle();a.preventDefault();break;case Garnish.RIGHT_KEY:Garnish.ltr?this.turnOn():this.turnOff();a.preventDefault();break;case Garnish.LEFT_KEY:Garnish.ltr?this.turnOff():this.turnOn(),a.preventDefault()}},_getMargin:function(){return parseInt(this.$innerContainer.css("marginLeft"))},_handleDragStart:function(){this.dragStartMargin=
this._getMargin()},_handleDrag:function(){var a=this.dragStartMargin+this.dragger.mouseDistX;a<Garnish.LightSwitch.offMargin?a=Garnish.LightSwitch.offMargin:0<a&&(a=0);this.$innerContainer.css("marginLeft",a)},_handleDragStop:function(){-16<this._getMargin()?this.turnOn():this.turnOff()},destroy:function(){this.$outerContainer.removeData("lightswitch");this.dragger.destroy();this.base()}},{offMargin:-50,defaults:{onChange:c.noop}});Garnish.Menu=Garnish.Base.extend({settings:null,$container:null,$options:null,
$anchor:null,_windowWidth:null,_windowHeight:null,_windowScrollLeft:null,_windowScrollTop:null,_anchorOffset:null,_anchorWidth:null,_anchorHeight:null,_anchorOffsetRight:null,_anchorOffsetBottom:null,_menuWidth:null,_menuHeight:null,init:function(a,b){this.setSettings(b,Garnish.Menu.defaults);this.$container=c(a);this.$options=c();this.addOptions(this.$container.find("a"));this.settings.attachToElement&&(this.settings.anchor=this.settings.attachToElement,Garnish.log("The 'attachToElement' setting is deprecated. Use 'anchor' instead."));
this.settings.anchor&&(this.$anchor=c(this.settings.anchor));this.addListener(this.$container,"mousedown",function(a){a.stopPropagation()})},addOptions:function(a){this.$options=this.$options.add(a);a.data("menu",this);this.addListener(a,"click","selectOption")},setPositionRelativeToAnchor:function(){this._windowWidth=Garnish.$win.width();this._windowHeight=Garnish.$win.height();this._windowScrollLeft=Garnish.$win.scrollLeft();this._windowScrollTop=Garnish.$win.scrollTop();this._anchorOffset=this.$anchor.offset();
this._anchorWidth=this.$anchor.outerWidth();this._anchorHeight=this.$anchor.outerHeight();this._anchorOffsetRight=this._anchorOffset.left+this._anchorHeight;this._anchorOffsetBottom=this._anchorOffset.top+this._anchorHeight;this.$container.css("minWidth",0);this.$container.css("minWidth",this._anchorWidth-(this.$container.outerWidth()-this.$container.width()));this._menuWidth=this.$container.outerWidth();this._menuHeight=this.$container.outerHeight();var a=this._anchorOffset.top-this._windowScrollTop,
b=this._windowHeight+this._windowScrollTop-this._anchorOffsetBottom;b>=this._menuHeight||b>=a||a<this._menuHeight?this.$container.css("top",this._anchorOffsetBottom):this.$container.css("top",this._anchorOffset.top-this._menuHeight);a=this.$container.data("align");"left"!=a&&"center"!=a&&"right"!=a&&(a="left");if("center"==a)this._alignCenter();else{var b=this._windowWidth+this._windowScrollLeft-(this._anchorOffset.left+this._menuWidth),c=this._anchorOffsetRight-this._menuWidth;"right"==a&&0<=c||
0>b?this._alignRight():this._alignLeft()}delete this._windowWidth;delete this._windowHeight;delete this._windowScrollLeft;delete this._windowScrollTop;delete this._anchorOffset;delete this._anchorWidth;delete this._anchorHeight;delete this._anchorOffsetRight;delete this._anchorOffsetBottom;delete this._menuWidth;delete this._menuHeight},show:function(){this.$container.appendTo(Garnish.$bod);this.$anchor&&this.setPositionRelativeToAnchor();this.$container.velocity("stop");this.$container.css({opacity:1,
display:"block"});Garnish.escManager.register(this,"hide")},hide:function(){this.$container.velocity("fadeOut",{duration:Garnish.FX_DURATION},c.proxy(function(){this.$container.detach()},this));Garnish.escManager.unregister(this);this.trigger("hide")},selectOption:function(a){this.settings.onOptionSelect(a.currentTarget);this.trigger("optionselect",{selectedOption:a.currentTarget});this.hide()},_alignLeft:function(){this.$container.css({left:this._anchorOffset.left,right:"auto"})},_alignRight:function(){this.$container.css({right:this._windowWidth-
(this._anchorOffset.left+this._anchorWidth),left:"auto"})},_alignCenter:function(){var a=Math.round(this._anchorOffset.left+this._anchorWidth/2-this._menuWidth/2);0>a&&(a=0);this.$container.css("left",a)}},{defaults:{anchor:null,onOptionSelect:c.noop}});Garnish.MenuBtn=Garnish.Base.extend({$btn:null,menu:null,showingMenu:!1,disabled:!0,init:function(a,b){this.$btn=c(a);if(this.$btn.data("menubtn")){var e=this.$btn.data("menubtn").menu.$container;Garnish.log("Double-instantiating a menu button on an element");
this.$btn.data("menubtn").destroy()}else e=this.$btn.next(".menu").detach();this.$btn.data("menubtn",this);this.setSettings(b,Garnish.MenuBtn.defaults);this.menu=new Garnish.Menu(e,{anchor:this.settings.menuAnchor||this.$btn,onOptionSelect:c.proxy(this,"onOptionSelect")});this.menu.on("hide",c.proxy(this,"onMenuHide"));this.addListener(this.$btn,"mousedown","onMouseDown");this.enable()},onMouseDown:function(a){a.which!=Garnish.PRIMARY_CLICK||Garnish.isCtrlKeyPressed(a)||(a.preventDefault(),this.showingMenu?
this.hideMenu():this.showMenu())},showMenu:function(){this.disabled||(this.menu.show(),this.$btn.addClass("active"),this.showingMenu=!0,setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","onMouseDown")},this),1))},hideMenu:function(){this.menu.hide()},onMenuHide:function(){this.$btn.removeClass("active");this.showingMenu=!1;this.removeListener(Garnish.$doc,"mousedown")},onOptionSelect:function(a){this.settings.onOptionSelect(a);this.trigger("optionSelect",{option:a})},enable:function(){this.disabled=
!1},disable:function(){this.disabled=!0},destroy:function(){this.$btn.removeData("menubtn");this.base()}},{defaults:{menuAnchor:null,onOptionSelect:c.noop}});Garnish.MixedInput=Garnish.Base.extend({$container:null,elements:null,focussedElement:null,blurTimeout:null,init:function(a,b){this.$container=c(a);this.setSettings(b,Garnish.MixedInput.defaults);this.elements=[];this.$container.attr("tabindex",0);this.addListener(this.$container,"focus","onFocus")},getElementIndex:function(a){return c.inArray(a,
this.elements)},isText:function(a){return"INPUT"==a.prop("nodeName")},onFocus:function(a){this.elements.length?(a=this.elements[0],this.setFocus(a),this.setCarotPos(a,0)):this.addTextElement()},addTextElement:function(a){var b=new r(this);this.addElement(b.$input,a);return b},addElement:function(a,b){if("undefined"==typeof b)if(this.focussedElement){var e=this.focussedElement,d=this.getElementIndex(e);if(this.isText(e)){var f=e.prop("selectionStart"),g=e.prop("selectionEnd"),k=e.val(),f=k.substring(0,
f),g=k.substr(g);f&&g?(e.val(f).trigger("change"),e=new r(this),e.$input.val(g).trigger("change"),this.addElement(e.$input,d+1),b=d+1):b=f?d+1:d}else b=d+1}else b=this.elements.length;"undefined"!=typeof this.elements[b]?(a.insertBefore(this.elements[b]),this.elements.splice(b,0,a)):(b=this.elements.length,this.$container.append(a),this.elements.push(a));this.isText(a)||(0!=b&&this.isText(this.elements[b-1])||(this.addTextElement(b),b++),b!=this.elements.length-1&&this.isText(this.elements[b+1])||
this.addTextElement(b+1));this.addListener(a,"click",function(){this.setFocus(a)});setTimeout(c.proxy(function(){this.setFocus(a)},this),1)},removeElement:function(a){var b=this.getElementIndex(a);if(-1!=b){this.elements.splice(b,1);if(!this.isText(a)){var c=this.elements[b-1],b=this.elements[b];if(this.isText(c)&&this.isText(b)){var d=c.val(),f=d+b.val();c.val(f).trigger("change");this.removeElement(b);this.setFocus(c);this.setCarotPos(c,d.length)}}a.remove()}},setFocus:function(a){this.$container.addClass("focus");
this.focussedElement?this.blurFocussedElement():this.$container.attr("tabindex","-1");a.attr("tabindex","0");a.focus();this.focussedElement=a;this.addListener(a,"blur",function(){this.blurTimeout=setTimeout(c.proxy(function(){this.focussedElement==a&&(this.blurFocussedElement(),this.focussedElement=null,this.$container.removeClass("focus"),this.$container.attr("tabindex","0"))},this),1)})},blurFocussedElement:function(){this.removeListener(this.focussedElement,"blur");this.focussedElement.attr("tabindex",
"-1")},focusPreviousElement:function(a){a=this.getElementIndex(a);if(0<a&&(a=this.elements[a-1],this.setFocus(a),this.isText(a))){var b=a.val().length;this.setCarotPos(a,b)}},focusNextElement:function(a){a=this.getElementIndex(a);a<this.elements.length-1&&(a=this.elements[a+1],this.setFocus(a),this.isText(a)&&this.setCarotPos(a,0))},setCarotPos:function(a,b){a.prop("selectionStart",b);a.prop("selectionEnd",b)}});var r=Garnish.Base.extend({parentInput:null,$input:null,$stage:null,val:null,focussed:!1,
interval:null,init:function(a){this.parentInput=a;this.$input=c('<input type="text"/>').appendTo(this.parentInput.$container);this.$input.css("margin-right",2-r.padding+"px");this.setWidth();this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.addListener(this.$input,"change","checkInput")},getIndex:function(){return this.parentInput.getElementIndex(this.$input)},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);
this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"nowrap"});Garnish.copyTextStyles(this.$input,this.$stage)},getTextWidth:function(a){this.$stage||this.buildStage();a&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/ /g,"&nbsp;"));this.$stage.html(a);return this.stageWidth=this.$stage.width()},onFocus:function(){this.focussed=!0;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=
!1;clearInterval(this.interval);this.checkInput()},onKeyDown:function(a){setTimeout(c.proxy(this,"checkInput"),1);switch(a.keyCode){case Garnish.LEFT_KEY:0==this.$input.prop("selectionStart")&&0==this.$input.prop("selectionEnd")&&this.parentInput.focusPreviousElement(this.$input);break;case Garnish.RIGHT_KEY:this.$input.prop("selectionStart")==this.val.length&&this.$input.prop("selectionEnd")==this.val.length&&this.parentInput.focusNextElement(this.$input);break;case Garnish.DELETE_KEY:0==this.$input.prop("selectionStart")&&
0==this.$input.prop("selectionEnd")&&(this.parentInput.focusPreviousElement(this.$input),a.preventDefault())}},getVal:function(){return this.val=this.$input.val()},setVal:function(a){this.$input.val(a);this.checkInput()},checkInput:function(){var a=this.val!==this.getVal();a&&(this.setWidth(),this.onChange());return a},setWidth:function(){this.stageWidth!==this.getTextWidth(this.val)&&this.$input.width(this.stageWidth+r.padding)},onChange:c.noop},{padding:20});Garnish.Modal=Garnish.Base.extend({$container:null,
$shade:null,visible:!1,dragger:null,desiredWidth:null,desiredHeight:null,resizeDragger:null,resizeStartWidth:null,resizeStartHeight:null,init:function(a,b){"undefined"==typeof b&&c.isPlainObject(a)&&(b=a,a=null);this.setSettings(b,Garnish.Modal.defaults);this.$shade=c('<div class="'+this.settings.shadeClass+'"/>');a?this.$shade.insertBefore(a):this.$shade.appendTo(Garnish.$bod);a&&(this.setContainer(a),this.settings.autoShow&&this.show());Garnish.Modal.instances.push(this)},setContainer:function(a){this.$container=
c(a);this.$container.data("modal")&&(Garnish.log("Double-instantiating a modal on an element"),this.$container.data("modal").destroy());this.$container.data("modal",this);this.settings.draggable&&(this.dragger=new Garnish.DragMove(this.$container,{handle:this.settings.dragHandleSelector?this.$container.find(this.settings.dragHandleSelector):this.$container}));this.settings.resizable&&(a=c('<div class="resizehandle"/>').appendTo(this.$container),this.resizeDragger=new Garnish.BaseDrag(a,{onDragStart:c.proxy(this,
"_handleResizeStart"),onDrag:c.proxy(this,"_handleResize")}));this.addListener(this.$container,"click",function(a){a.stopPropagation()});this.visible&&this.show()},show:function(){this.settings.closeOtherModals&&Garnish.Modal.visibleModal&&Garnish.Modal.visibleModal!=this&&Garnish.Modal.visibleModal.hide();this.$container&&(this.$shade.appendTo(Garnish.$bod),this.$container.appendTo(Garnish.$bod),this.$container.show(),this.updateSizeAndPosition(),this.$shade.velocity("fadeIn",{duration:50}),this.$container.delay(50).velocity("fadeIn",
{complete:c.proxy(this,"onFadeIn")}),this.settings.hideOnShadeClick&&this.addListener(this.$shade,"click","hide"),this.addListener(Garnish.$win,"resize","updateSizeAndPosition"));this.enable();this.settings.hideOnEsc&&Garnish.escManager.register(this,"hide");this.visible||(this.visible=!0,Garnish.Modal.visibleModal=this,this.trigger("show"),this.settings.onShow())},quickShow:function(){this.show();this.$container&&(this.$container.velocity("stop"),this.$container.show().css("opacity",1),this.$shade.velocity("stop"),
this.$shade.show().css("opacity",1))},hide:function(a){this.disable();a&&a.stopPropagation();this.$container&&(this.$container.velocity("fadeOut",{duration:Garnish.FX_DURATION}),this.$shade.velocity("fadeOut",{duration:Garnish.FX_DURATION,complete:c.proxy(this,"onFadeOut")}),this.settings.hideOnShadeClick&&this.removeListener(this.$shade,"click"),this.removeListener(Garnish.$win,"resize"));this.visible=!1;Garnish.Modal.visibleModal=null;this.settings.hideOnEsc&&Garnish.escManager.unregister(this);
this.trigger("hide");this.settings.onHide()},quickHide:function(){this.hide();this.$container&&(this.$container.velocity("stop"),this.$container.css("opacity",0).hide(),this.$shade.velocity("stop"),this.$shade.css("opacity",0).hide())},updateSizeAndPosition:function(){this.$container&&(this.$container.css({width:this.desiredWidth?Math.max(this.desiredWidth,200):"",height:this.desiredHeight?Math.max(this.desiredHeight,200):"","min-width":"","min-height":""}),this.updateSizeAndPosition._windowWidth=
Garnish.$win.width(),this.updateSizeAndPosition._width=Math.min(this.getWidth(),this.updateSizeAndPosition._windowWidth-2*this.settings.minGutter),this.$container.css({width:this.updateSizeAndPosition._width,"min-width":this.updateSizeAndPosition._width,left:Math.round((this.updateSizeAndPosition._windowWidth-this.updateSizeAndPosition._width)/2)}),this.updateSizeAndPosition._windowHeight=Garnish.$win.height(),this.updateSizeAndPosition._height=Math.min(this.getHeight(),this.updateSizeAndPosition._windowHeight-
2*this.settings.minGutter),this.$container.css({height:this.updateSizeAndPosition._height,"min-height":this.updateSizeAndPosition._height,top:Math.round((this.updateSizeAndPosition._windowHeight-this.updateSizeAndPosition._height)/2)}))},onFadeIn:function(){this.trigger("fadeIn");this.settings.onFadeIn()},onFadeOut:function(){this.trigger("fadeOut");this.settings.onFadeOut()},getHeight:function(){if(!this.$container)throw"Attempted to get the height of a modal whose container has not been set.";this.visible||
this.$container.show();this.getHeight._height=this.$container.outerHeight();this.visible||this.$container.hide();return this.getHeight._height},getWidth:function(){if(!this.$container)throw"Attempted to get the width of a modal whose container has not been set.";this.visible||this.$container.show();this.getWidth._width=this.$container.outerWidth()+1;this.visible||this.$container.hide();return this.getWidth._width},_handleResizeStart:function(){this.resizeStartWidth=this.getWidth();this.resizeStartHeight=
this.getHeight()},_handleResize:function(){this.desiredWidth=Garnish.ltr?this.resizeStartWidth+2*this.resizeDragger.mouseDistX:this.resizeStartWidth-2*this.resizeDragger.mouseDistX;this.desiredHeight=this.resizeStartHeight+2*this.resizeDragger.mouseDistY;this.updateSizeAndPosition()},destroy:function(){this.$container&&this.$container.removeData("modal").remove();this.dragger&&this.dragger.destroy();this.resizeDragger&&this.resizeDragger.destroy();this.base()}},{relativeElemPadding:8,defaults:{autoShow:!0,
draggable:!1,dragHandleSelector:null,resizable:!1,minGutter:10,onShow:c.noop,onHide:c.noop,onFadeIn:c.noop,onFadeOut:c.noop,closeOtherModals:!1,hideOnEsc:!0,hideOnShadeClick:!0,shadeClass:"modal-shade"},instances:[],visibleModal:null});Garnish.NiceText=Garnish.Base.extend({$input:null,$hint:null,$stage:null,$charsLeft:null,autoHeight:null,maxLength:null,showCharsLeft:!1,showingHint:!1,val:null,inputBoxSizing:"content-box",width:null,height:null,minHeight:null,initialized:!1,init:function(a,b){this.$input=
c(a);this.settings=c.extend({},Garnish.NiceText.defaults,b);this.isVisible()?this.initialize():this.addListener(Garnish.$win,"resize","initializeIfVisible")},isVisible:function(){return 0<this.$input.height()},initialize:function(){if(!this.initialized){this.initialized=!0;this.removeListener(Garnish.$win,"resize");if(this.maxLength=this.$input.attr("maxlength"))this.maxLength=parseInt(this.maxLength);this.maxLength&&(this.settings.showCharsLeft||Garnish.hasAttr(this.$input,"data-show-chars-left"))&&
(this.showCharsLeft=!0,this.$input.removeAttr("maxlength"));this.$input.data("nicetext")&&(Garnish.log("Double-instantiating a transparent text input on an element"),this.$input.data("nicetext").destroy());this.$input.data("nicetext",this);this.getVal();if(this.autoHeight=this.settings.autoHeight&&"TEXTAREA"==this.$input.prop("nodeName"))this.minHeight=this.getHeightForValue(""),this.updateHeight(),this.width=this.$input.width(),this.addListener(Garnish.$win,"resize","updateHeightIfWidthChanged");
this.settings.hint&&(this.$hintContainer=c('<div class="texthint-container"/>').insertBefore(this.$input),this.$hint=c('<div class="texthint">'+this.settings.hint+"</div>").appendTo(this.$hintContainer),this.$hint.css({top:parseInt(this.$input.css("borderTopWidth"))+parseInt(this.$input.css("paddingTop")),left:parseInt(this.$input.css("borderLeftWidth"))+parseInt(this.$input.css("paddingLeft"))+1}),Garnish.copyTextStyles(this.$input,this.$hint),this.val?this.$hint.hide():this.showingHint=!0,this.addListener(this.$hint,
"mousedown",function(a){a.preventDefault();this.$input.focus()}));this.showCharsLeft&&(this.$charsLeft=c('<div class="'+this.settings.charsLeftClass+'"/>').insertAfter(this.$input),this.updateCharsLeft());this.addListener(this.$input,"textchange","onTextChange")}},initializeIfVisible:function(){this.isVisible()&&this.initialize()},getVal:function(){return this.val=this.$input.val()},showHint:function(){this.$hint.velocity("fadeIn",{complete:Garnish.NiceText.hintFadeDuration});this.showingHint=!0},
hideHint:function(){this.$hint.velocity("fadeOut",{complete:Garnish.NiceText.hintFadeDuration});this.showingHint=!1},onTextChange:function(){this.getVal();this.$hint&&(this.showingHint&&this.val?this.hideHint():this.showingHint||this.val||this.showHint());this.autoHeight&&this.updateHeight();this.showCharsLeft&&this.updateCharsLeft()},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({display:"block",position:"absolute",top:-9999,left:-9999});this.inputBoxSizing=
this.$input.css("box-sizing");"border-box"==this.inputBoxSizing&&this.$stage.css({"border-top":this.$input.css("border-top"),"border-right":this.$input.css("border-right"),"border-bottom":this.$input.css("border-bottom"),"border-left":this.$input.css("border-left"),"padding-top":this.$input.css("padding-top"),"padding-right":this.$input.css("padding-right"),"padding-bottom":this.$input.css("padding-bottom"),"padding-left":this.$input.css("padding-left"),"-webkit-box-sizing":this.inputBoxSizing,"-moz-box-sizing":this.inputBoxSizing,
"box-sizing":this.inputBoxSizing});Garnish.copyTextStyles(this.$input,this.$stage)},getHeightForValue:function(a){this.$stage||this.buildStage();"border-box"==this.inputBoxSizing?this.$stage.css("width",this.$input.outerWidth()):this.$stage.css("width",this.$input.width());if(a)a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/ /g,"&nbsp;"),a=a.replace(/[\n\r]$/g,""),a=a.replace(/[\n\r]/g,"<br/>"),a+="<br/>&nbsp;";else{a="&nbsp;";for(var b=1;b<this.$input.prop("rows");b++)a+=
"<br/>&nbsp;"}this.$stage.html(a);this.getHeightForValue._height="border-box"==this.inputBoxSizing?this.$stage.outerHeight():this.$stage.height();this.minHeight&&this.getHeightForValue._height<this.minHeight&&(this.getHeightForValue._height=this.minHeight);return this.getHeightForValue._height},updateHeight:function(){if(this.height!==(this.height=this.getHeightForValue(this.val))&&(this.$input.css("min-height",this.height),this.initialized))this.onHeightChange()},updateHeightIfWidthChanged:function(){this.width!==
(this.width=this.$input.width())&&this.width&&this.updateHeight()},onHeightChange:function(){this.settings.onHeightChange()},updateCharsLeft:function(){this.updateCharsLeft._charsLeft=this.maxLength-this.val.length;this.$charsLeft.text(this.updateCharsLeft._charsLeft);0<=this.updateCharsLeft._charsLeft?this.$charsLeft.removeClass(this.settings.negativeCharsLeftClass):this.$charsLeft.addClass(this.settings.negativeCharsLeftClass)},destroy:function(){this.$input.removeData("nicetext");this.$hint&&this.$hint.remove();
this.$stage&&this.$stage.remove();this.base()}},{interval:100,hintFadeDuration:50,defaults:{autoHeight:!0,showCharsLeft:!1,charsLeftClass:"chars-left",negativeCharsLeftClass:"negative-chars-left",onHeightChange:c.noop}});Garnish.Pill=Garnish.Base.extend({$outerContainer:null,$innerContainer:null,$btns:null,$selectedBtn:null,$input:null,init:function(a){this.$outerContainer=c(a);this.$outerContainer.data("pill")&&(Garnish.log("Double-instantiating a pill on an element"),this.$outerContainer.data("pill").destroy());
this.$outerContainer.data("pill",this);this.$innerContainer=this.$outerContainer.find(".btngroup:first");this.$btns=this.$innerContainer.find(".btn");this.$selectedBtn=this.$btns.filter(".active:first");this.$input=this.$outerContainer.find("input:first");Garnish.preventOutlineOnMouseFocus(this.$innerContainer);this.addListener(this.$btns,"mousedown","onMouseDown");this.addListener(this.$innerContainer,"keydown","onKeyDown")},select:function(a){this.$selectedBtn.removeClass("active");a=c(a);a.addClass("active");
this.$input.val(a.attr("data-value"));this.$selectedBtn=a},selectNext:function(){if(this.$selectedBtn.length){var a=this._getSelectedBtnIndex()+1;"undefined"!=typeof this.$btns[a]&&this.select(this.$btns[a])}else this.select(this.$btns[this.$btns.length-1])},selectPrev:function(){if(this.$selectedBtn.length){var a=this._getSelectedBtnIndex()-1;"undefined"!=typeof this.$btns[a]&&this.select(this.$btns[a])}else this.select(this.$btns[0])},onMouseDown:function(a){this.select(a.currentTarget)},_getSelectedBtnIndex:function(){return"undefined"!=
typeof this.$selectedBtn[0]?c.inArray(this.$selectedBtn[0],this.$btns):-1},onKeyDown:function(a){switch(a.keyCode){case Garnish.RIGHT_KEY:Garnish.ltr?this.selectNext():this.selectPrev();a.preventDefault();break;case Garnish.LEFT_KEY:Garnish.ltr?this.selectPrev():this.selectNext(),a.preventDefault()}},destroy:function(){this.$outerContainer.removeData("pill");this.base()}});Garnish.Select=Garnish.Base.extend({$container:null,$items:null,$selectedItems:null,mousedownTarget:null,mouseUpTimeout:null,
callbackFrame:null,$focusable:null,$first:null,first:null,$last:null,last:null,init:function(a,b,e){this.$container=c(a);"undefined"==typeof b&&c.isPlainObject(a)?(e=a,b=a=null):"undefined"==typeof e&&c.isPlainObject(b)&&(e=b,b=null);this.$container.data("select")&&(Garnish.log("Double-instantiating a select on an element"),this.$container.data("select").destroy());this.$container.data("select",this);this.setSettings(e,Garnish.Select.defaults);this.$items=c();this.$selectedItems=c();this.addItems(b);
this.settings.allowEmpty&&!this.settings.checkboxMode&&this.addListener(this.$container,"click",function(a){this.ignoreClick?this.ignoreClick=!1:this.deselectAll(!0)})},getItemIndex:function(a){return this.$items.index(a[0])},isSelected:function(a){if(Garnish.isJquery(a)){if(!a[0])return!1;a=a[0]}return-1!=c.inArray(a,this.$selectedItems)},selectItem:function(a,b,c){this.settings.multi||this.deselectAll();this.$first=this.$last=a;this.first=this.last=this.getItemIndex(a);b&&(this.setFocusableItem(a),
this.focusItem(a,c));this._selectItems(a)},selectAll:function(){this.settings.multi&&this.$items.length&&(this.first=0,this.last=this.$items.length-1,this.$first=this.$items.eq(this.first),this.$last=this.$items.eq(this.last),this._selectItems(this.$items))},selectRange:function(a,b){if(!this.settings.multi)return this.selectItem(a,!0);this.deselectAll();this.$last=a;this.last=this.getItemIndex(a);this.setFocusableItem(a);this.focusItem(a,b);if(this.first<this.last)var c=this.first,d=this.last+1;
else c=this.last,d=this.first+1;this._selectItems(this.$items.slice(c,d))},deselectItem:function(a){var b=this.getItemIndex(a);this.first===b&&(this.$first=this.first=null);this.last===b&&(this.$last=this.last=null);this._deselectItems(a)},deselectAll:function(a){a&&(this.$first=this.first=this.$last=this.last=null);this._deselectItems(this.$items)},deselectOthers:function(a){this.deselectAll();this.selectItem(a,!0)},toggleItem:function(a,b){this.isSelected(a)?this._canDeselect(a)&&this.deselectItem(a,
!0):this.selectItem(a,!0,b)},clearMouseUpTimeout:function(){clearTimeout(this.mouseUpTimeout)},getFirstItem:function(){if(this.$items.length)return this.$items.first()},getLastItem:function(){if(this.$items.length)return this.$items.last()},isPreviousItem:function(a){return 0<a},isNextItem:function(a){return a<this.$items.length-1},getPreviousItem:function(a){if(this.isPreviousItem(a))return this.$items.eq(a-1)},getNextItem:function(a){if(this.isNextItem(a))return this.$items.eq(a+1)},getItemToTheLeft:function(a){var b=
Garnish.ltr?"Previous":"Next";if(this["is"+b+"Item"](a)){if(this.settings.horizontal)return this["get"+b+"Item"](a);if(!this.settings.vertical)return this.getClosestItem(a,Garnish.X_AXIS,"<")}},getItemToTheRight:function(a){var b=Garnish.ltr?"Next":"Previous";if(this["is"+b+"Item"](a)){if(this.settings.horizontal)return this["get"+b+"Item"](a);if(!this.settings.vertical)return this.getClosestItem(a,Garnish.X_AXIS,">")}},getItemAbove:function(a){if(this.isPreviousItem(a)){if(this.settings.vertical)return this.getPreviousItem(a);
if(!this.settings.horizontal)return this.getClosestItem(a,Garnish.Y_AXIS,"<")}},getItemBelow:function(a){if(this.isNextItem(a)){if(this.settings.vertical)return this.getNextItem(a);if(!this.settings.horizontal)return this.getClosestItem(a,Garnish.Y_AXIS,">")}},getClosestItem:function(a,b,c){var d=Garnish.Select.closestItemAxisProps[b];c=Garnish.Select.closestItemDirectionProps[c];var f=this.$items.eq(a),g=f.offset(),f=g[d.midpointOffset]+Math.round(f[d.midpointSizeFunc]()/2),k=null,h=null,l=null;
b=Garnish.rtl&&b==Garnish.X_AXIS?-1*c.step:c.step;for(a+=b;"undefined"!=typeof this.$items[a];a+=b){var p=this.$items.eq(a),m=p.offset();if(c.isNextRow(m[d.rowOffset],g[d.rowOffset])){if(null===k)k=m[d.rowOffset];else if(m[d.rowOffset]!=k)break;m=m[d.midpointOffset]+Math.round(p[d.midpointSizeFunc]()/2);m=Math.abs(f-m);if(null===h||m<h)h=m,l=p;else break}else if(c.isWrongDirection(m[d.rowOffset],g[d.rowOffset]))break}return l},getFurthestItemToTheLeft:function(a){return this.getFurthestItem(a,"ToTheLeft")},
getFurthestItemToTheRight:function(a){return this.getFurthestItem(a,"ToTheRight")},getFurthestItemAbove:function(a){return this.getFurthestItem(a,"Above")},getFurthestItemBelow:function(a){return this.getFurthestItem(a,"Below")},getFurthestItem:function(a,b){for(var c,d;d=this["getItem"+b](a);)c=d,a=this.getItemIndex(c);return c},get totalSelected(){return this.getTotalSelected()},getTotalSelected:function(){return this.$selectedItems.length},addItems:function(a){a=c(a);for(var b=0;b<a.length;b++){var e=
a[b];c.data(e,"select")&&(Garnish.log("Element was added to more than one selector"),c.data(e,"select").removeItems(e));c.data(e,"select",this);if(this.settings.handle)if("object"==typeof this.settings.handle)var d=c(this.settings.handle);else"string"==typeof this.settings.handle?d=c(e).find(this.settings.handle):"function"==typeof this.settings.handle&&(d=c(this.settings.handle(e)));else d=c(e);c.data(e,"select-handle",d);d.data("select-item",e);this.addListener(d,"mousedown","onMouseDown");this.addListener(d,
"mouseup","onMouseUp");this.addListener(d,"click",function(a){this.ignoreClick=!0});this.addListener(e,"keydown","onKeyDown")}this.$items=this.$items.add(a);this.updateIndexes()},removeItems:function(a){a=c.makeArray(a);for(var b=!1,e=!1,d=0;d<a.length;d++){var f=a[d],g=c.inArray(f,this.$items);-1!=g&&(this._deinitItem(f),this.$items.splice(g,1),b=!0,f=c.inArray(f,this.$selectedItems),-1!=f&&(this.$selectedItems.splice(f,1),e=!0))}b&&(this.updateIndexes(),e&&(c(a).removeClass(this.settings.selectedClass),
this.onSelectionChange()))},removeAllItems:function(){for(var a=0;a<this.$items.length;a++)this._deinitItem(this.$items[a]);this.$items=c();this.$selectedItems=c();this.updateIndexes()},updateIndexes:function(){null!==this.first?(this.first=this.getItemIndex(this.$first),this.setFocusableItem(this.$first)):this.$items.length&&this.setFocusableItem(c(this.$items[0]));null!==this.last&&(this.last=this.getItemIndex(this.$last))},resetItemOrder:function(){this.$items=c().add(this.$items);this.$selectedItems=
c().add(this.$selectedItems);this.updateIndexes()},setFocusableItem:function(a){this.$focusable&&this.$focusable.removeAttr("tabindex");this.$focusable=a.attr("tabindex","0")},focusItem:function(a,b){if(b){var c=Garnish.$doc.scrollLeft(),d=Garnish.$doc.scrollTop();a.focus();window.scrollTo(c,d)}else a.focus()},getSelectedItems:function(){return this.$selectedItems},destroy:function(){this.$container.removeData("select");this.removeAllItems();this.base()},onMouseDown:function(a){if(a.which==Garnish.PRIMARY_CLICK&&
(!this.settings.filter||c(a.target).is(this.settings.filter))){this.mousedownTarget=a.currentTarget;var b=c(c.data(a.currentTarget,"select-item"));null!==this.first&&a.shiftKey?this.selectRange(b,!0):this._actAsCheckbox(a)&&this.toggleItem(b,!0)}},onMouseUp:function(a){if(a.which==Garnish.PRIMARY_CLICK&&(!this.settings.filter||c(a.target).is(this.settings.filter))){var b=c(c.data(a.currentTarget,"select-item"));this._actAsCheckbox(a)||a.shiftKey||a.currentTarget!=this.mousedownTarget||(this.isSelected(b)?
(this.clearMouseUpTimeout(),this.mouseUpTimeout=setTimeout(c.proxy(function(){this.deselectOthers(b)},this),300)):(this.deselectAll(),this.selectItem(b,!0,!0)))}},onKeyDown:function(a){if(a.target==a.currentTarget){var b=Garnish.isCtrlKeyPressed(a);if(this.settings.checkboxMode&&this.$focusable.length)e=c.inArray(this.$focusable[0],this.$items),-1==e&&(e=0);else var e=a.shiftKey?this.last:this.first;switch(a.keyCode){case Garnish.LEFT_KEY:a.preventDefault();var d=null===this.first?Garnish.ltr?this.getLastItem():
this.getFirstItem():b?this.getFurthestItemToTheLeft(e):this.getItemToTheLeft(e);break;case Garnish.RIGHT_KEY:a.preventDefault();d=null===this.first?Garnish.ltr?this.getFirstItem():this.getLastItem():b?this.getFurthestItemToTheRight(e):this.getItemToTheRight(e);break;case Garnish.UP_KEY:a.preventDefault();null===this.first?(this.$focusable&&(d=this.$focusable.prev()),this.$focusable&&d.length||(d=this.getLastItem())):(d=b?this.getFurthestItemAbove(e):this.getItemAbove(e))||(d=this.getFirstItem());
break;case Garnish.DOWN_KEY:a.preventDefault();null===this.first?(this.$focusable&&(d=this.$focusable.next()),this.$focusable&&d.length||(d=this.getFirstItem())):(d=b?this.getFurthestItemBelow(e):this.getItemBelow(e))||(d=this.getLastItem());break;case Garnish.SPACE_KEY:b||(a.preventDefault(),this.isSelected(this.$focusable)?this._canDeselect(this.$focusable)&&this.deselectItem(this.$focusable):this.selectItem(this.$focusable,!0));break;case Garnish.A_KEY:b&&(a.preventDefault(),this.selectAll())}d&&
d.length&&(this.settings.checkboxMode?(this.setFocusableItem(d),d.focus()):null!==this.first&&a.shiftKey?this.selectRange(d):(this.deselectAll(),this.selectItem(d,!0)))}},onSelectionChange:function(){this.callbackFrame&&(Garnish.cancelAnimationFrame(this.callbackFrame),this.callbackFrame=null);this.callbackFrame=Garnish.requestAnimationFrame(c.proxy(function(){this.callbackFrame=null;this.trigger("selectionChange");this.settings.onSelectionChange()},this))},_actAsCheckbox:function(a){return Garnish.isCtrlKeyPressed(a)?
!this.settings.checkboxMode:this.settings.checkboxMode},_canDeselect:function(a){return this.settings.allowEmpty||this.totalSelected>a.length},_selectItems:function(a){a.addClass(this.settings.selectedClass);this.$selectedItems=this.$selectedItems.add(a);this.onSelectionChange()},_deselectItems:function(a){a.removeClass(this.settings.selectedClass);this.$selectedItems=this.$selectedItems.not(a);this.onSelectionChange()},_deinitItem:function(a){var b=c.data(a,"select-handle");b&&(b.removeData("select-item"),
this.removeAllListeners(b));c.removeData(a,"select");c.removeData(a,"select-handle")}},{defaults:{selectedClass:"sel",multi:!1,allowEmpty:!0,vertical:!1,horizontal:!1,handle:null,filter:null,checkboxMode:!1,onSelectionChange:c.noop},closestItemAxisProps:{x:{midpointOffset:"top",midpointSizeFunc:"outerHeight",rowOffset:"left"},y:{midpointOffset:"left",midpointSizeFunc:"outerWidth",rowOffset:"top"}},closestItemDirectionProps:{"<":{step:-1,isNextRow:function(a,b){return a<b},isWrongDirection:function(a,
b){return a>b}},">":{step:1,isNextRow:function(a,b){return a>b},isWrongDirection:function(a,b){return a<b}}}});Garnish.SelectMenu=Garnish.Menu.extend({init:function(a,b,e,d){"function"==typeof e&&(d=e,e={});e=c.extend({},Garnish.SelectMenu.defaults,e);this.base(a,b,e,d);this.selected=-1},build:function(){this.base();-1!=this.selected&&this._addSelectedOptionClass(this.selected)},select:function(a){a!=this.selected&&(this.dom.ul&&(-1!=this.selected&&(this.dom.options[this.selected].className=""),this._addSelectedOptionClass(a)),
this.selected=a,this.setBtnText(c(this.options[a].label).text()),this.base(a))},_addSelectedOptionClass:function(a){this.dom.options[a].className="sel"},setBtnText:function(a){this.dom.$btnLabel.text(a)}},{defaults:{ulClass:"menu select"}})})(jQuery);

//# sourceMappingURL=garnish-0.1.min.map
